# AI Trading Bot v2 - 기본 설정
# ================================
# 목표: 일 1% 수익률, 손익비 2:1 기준 최적화

# 트레이딩 기본 설정
trading:
  initial_capital: 10000000      # 초기 자본금 (1000만원)
  market: KRX                    # 시장 (KRX, NASDAQ, NYSE)

  # 거래 시간대
  enable_pre_market: true        # 프리장 (08:00~08:50)
  enable_next_market: true       # 넥스트장 (15:30~20:00)

  # 수수료 (한국투자증권 기준, 2024년 세율 적용)
  fees:
    buy_rate: 0.00015            # 매수 수수료 0.015%
    sell_rate: 0.00195           # 매도 수수료 0.015% + 증권거래세 0.18%

  # 슬리피지
  slippage:
    expected_ticks: 1
    max_ticks: 3


# 리스크 관리 설정 (일 1% 목표 최적화)
risk:
  # === 일일 한도 ===
  daily_max_loss_pct: 3.0        # 하루 최대 손실 3% (5%→3% 축소: 일 1% 목표 시 3일치 손실이 상한)
  daily_max_trades: 15           # 일일 최대 거래 15회 (과잉매매 방지)

  # === 포지션 관리 ===
  base_position_pct: 15.0        # 기본 포지션 비율 15% (12→15: 집중 투자로 자본 효율↑)
  max_position_pct: 25.0         # 최대 포지션 비율 25% (35→25: 단일 종목 리스크 축소, SK하이닉스 사례 반영)
  max_positions: 0               # 최대 동시 포지션 0개 (보호 모드: 신규 진입 차단)
  min_cash_reserve_pct: 5.0      # 최소 현금 보유 5% (15→5: 신규 진입 여력 확보)
  min_position_value: 500000     # 최소 포지션 금액 (50만원)
  dynamic_max_positions: true    # 자산 규모에 따라 max_positions 동적 조정

  # === 손절/익절 (기본값, ExitManager에서 오버라이드) ===
  default_stop_loss_pct: 2.5     # 기본 손절 2.5% (2→2.5: 노이즈 손절 감소)
  default_take_profit_pct: 5.0   # 기본 익절 5.0% (3→5: 목표 수익 확대)
  trailing_stop_pct: 1.5         # 트레일링 스탑 1.5%

  # === 특별 상황 ===
  hot_theme_position_pct: 50.0   # 핫 테마 시 최대 포지션 50% (70→50: 테마 집중 리스크 완화)
  momentum_multiplier: 1.5       # 강한 모멘텀 시 배팅 증가


# 전략 설정
strategies:
  # 모멘텀 브레이크아웃 (주력 전략)
  momentum_breakout:
    enabled: false  # 보호 모드: 비활성화
    breakout_period: 20          # 돌파 기준 기간 (일)
    confirm_candles: 2           # 돌파 확인 캔들 수
    min_breakout_pct: 0.5        # 최소 돌파 비율 (%)
    volume_surge_ratio: 2.0      # 거래량 급증 기준

    # 점수 가중치
    weight_price_momentum: 40.0
    weight_volume_momentum: 30.0
    weight_high_proximity: 20.0
    weight_theme: 10.0

    # 청산 조건 (R:R = 5:2.5 = 2:1)
    stop_loss_pct: 2.5           # 2→2.5: 노이즈 방어
    take_profit_pct: 5.0
    trailing_stop_pct: 1.5

  # 테마 추종 (빠른 진입/탈출)
  theme_chasing:
    enabled: false  # 보호 모드: 비활성화
    min_theme_score: 70
    entry_window_minutes: 30
    stop_loss_pct: 2.0           # 1.5→2.0: 테마주 변동성 감안
    take_profit_pct: 4.0         # 3→4: 테마 모멘텀 활용
    trailing_stop_pct: 1.0

  # 갭상승 추종
  gap_and_go:
    enabled: false  # 보호 모드: 비활성화
    min_gap_pct: 2.0
    max_gap_pct: 10.0
    entry_delay_minutes: 30
    pullback_pct: 1.0
    min_volume_ratio: 2.0
    stop_loss_pct: 2.0           # 1.5→2.0: 갭 변동성 감안
    take_profit_pct: 4.0
    trailing_stop_pct: 1.5

  # 평균 회귀 (급락 반등, 보조 전략)
  mean_reversion:
    enabled: false  # 보호 모드: 비활성화
    max_rsi: 30.0
    min_decline_pct: -10.0
    min_volume_ratio: 1.5
    stop_loss_pct: 3.0           # 유지: 역추세 특성상 넓은 SL 필요
    take_profit_pct: 5.0
    trailing_stop_pct: 2.0
    position_size_multiplier: 0.5  # 포지션 절반 (역추세 리스크 관리)


# 브로커 설정
broker:
  type: kis                      # kis, alpaca, ib
  kis:
    env: prod                    # prod, dev (모의투자)
    timeout_seconds: 15


# 데이터 설정
data:
  realtime_source: kis_websocket

  storage:
    type: file
    file_path: ./data/prices

  history:
    lookback_days: 60
    cache_enabled: true


# 로깅 설정
logging:
  level: INFO
  file_enabled: true
  file_path: ./logs
  rotation: 1 day
  retention: 7 days


# 알림 설정
notification:
  telegram:
    enabled: true

  alerts:
    on_signal: false
    on_order: false
    on_fill: false
    on_risk_alert: false
    on_daily_summary: true


# 분할 익절 관리자 (R:R 최적화)
exit_manager:
  enable_partial_exit: true
  first_exit_pct: 3.0             # 1차 익절 목표 (%)
  first_exit_ratio: 0.3           # 30% 매도 (50→30: 수익 종목 더 보유)
  second_exit_pct: 5.0            # 2차 익절 목표 (%)
  second_exit_ratio: 0.5          # 잔여 50% 매도 (=전체 35%)
  stop_loss_pct: 2.5              # 손절 2.5% (2→2.5: 노이즈 방어)
  trailing_stop_pct: 1.5          # 트레일링 스탑 (%)
  trailing_activate_pct: 3.0      # 트레일링 활성화 3% (2→3: 1차 익절과 동기화)
  include_fees: true


# 종목 스크리너
screener:
  scan_interval_minutes: 5        # 스캔 주기 5분 (10→5: 기회 빠른 포착)
  min_volume_ratio: 2.0
  min_change_pct: 1.0
  max_change_pct: 15.0
  min_market_cap: 1000


# 테마 탐지기
theme_detector:
  scan_interval_minutes: 10       # 테마 스캔 10분 (15→10: 테마 초기 포착)
  min_news_count: 3
  min_theme_score: 70.0


# US 시장 오버나이트 시그널
us_market:
  enabled: true
  fetch_time: "07:30"
  cache_ttl_hours: 24


# 자가 진화 엔진
evolution:
  enabled: true
  analysis_days: 7
  min_trades_for_evolution: 5
  min_confidence_to_apply: 0.6
  auto_rollback_threshold: -2.0
  evaluation_period_days: 7
  send_telegram: false


# 코드 자동 진화 (Claude Code CLI)
code_evolution:
  enabled: false                   # 기본 비활성화 (수동으로 활성화)
  schedule_day: 5                  # 실행 요일 (0=월 ~ 6=일, 5=토)
  schedule_hour: 10                # 실행 시각 (24시간)
  max_changed_files: 10            # 최대 변경 파일 수
  claude_timeout: 300              # Claude CLI 타임아웃 (초)


# 종목 마스터
stock_master:
  enabled: true
  refresh_time: "18:00"              # 일일 갱신 시간
  skip_weekends: true                # 주말 갱신 스킵

  # 추가 설정
  auto_initial_refresh: true         # 빈 테이블 시 자동 갱신
  cache_ttl_hours: 24                # 캐시 TTL (시간)
  alert_on_consecutive_failures: 3   # N일 연속 실패 시 알림


# 스케줄러 설정
scheduler:
  morning_report_time: "08:00"
  evening_report_time: "17:00"
  evolution_time: "20:30"
  nxt_refresh_hour: 6
  news_impact_threshold: 5


# 대시보드 설정
dashboard:
  enabled: true
  host: "0.0.0.0"
  port: 8080


# 워치리스트 (모니터링 종목)
watchlist:
  # 핵심 대형주
  - code: "005930"
    name: "삼성전자"
    sector: "반도체"

  - code: "000660"
    name: "SK하이닉스"
    sector: "반도체"

  - code: "373220"
    name: "LG에너지솔루션"
    sector: "2차전지"

  # 테마주 (필요시 추가)
